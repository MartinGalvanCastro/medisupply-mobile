/**
 * Generated by orval v7.15.0 üç∫
 * Do not edit manually.
 * BFF Service
 * Backend For Frontend service aggregating microservices
 * OpenAPI spec version: 1.0.0
 */
import { useMutation } from "@tanstack/react-query";
import type {
  MutationFunction,
  QueryClient,
  UseMutationOptions,
  UseMutationResult,
} from "@tanstack/react-query";

import type { AblyTokenResponse } from ".././models";

import { customInstance } from "../../client";

type SecondParameter<T extends (...args: never) => unknown> = Parameters<T>[1];

/**
 * Generate an Ably token request for the authenticated user.

This endpoint creates a token request that allows the client to authenticate
with Ably's real-time service and subscribe to appropriate channels based on
their user type.

Channel Permissions:
    - Web Users (web_users group):
        * Subscribe to: users:{user_id}
        * Use case: Personal notifications, reports, real-time updates

    - Seller Users (seller_users group):
        * Subscribe to: mobile:products
        * Use case: Product inventory updates, catalog changes

    - Client Users (client_users group):
        * Subscribe to: mobile:products
        * Use case: Product catalog updates, availability changes

Token Details:
    - TTL: 1 hour (3600000 milliseconds)
    - Permissions: Subscribe only (no publish capability)
    - Includes: keyName, ttl, timestamp, capability, nonce, mac

Security:
    - Requires valid JWT token in Authorization header
    - Tokens are signed server-side with HMAC
    - Each token is scoped to specific channels
    - No publish permissions granted to clients

Args:
    user: Authenticated user from JWT token (injected by get_current_user)
    token_service: AblyTokenService instance (injected by get_token_service)

Returns:
    AblyTokenResponse containing:
        - token_request: Signed token request object for Ably authentication
        - expires_at: Unix timestamp (ms) when the token expires
        - channels: List of channels the token grants access to

Raises:
    HTTPException:
        - 400: If user_id is missing or user_type cannot be determined
        - 401: If authentication token is invalid or missing
        - 503: If Ably service is not configured or unavailable

Example Response:
    ```json
    {
        "token_request": {
            "keyName": "key_id",
            "ttl": 3600000,
            "timestamp": 1640000000000,
            "capability": "{\"web:user123\":[\"subscribe\"],\"web:broadcasts\":[\"subscribe\"]}",
            "nonce": "a1b2c3d4e5",
            "mac": "dGVzdF9tYWNfc2lnbmF0dXJl"
        },
        "expires_at": 1640003600000,
        "channels": ["web:user123", "web:broadcasts"]
    }
    ```

Example Usage:
    ```bash
    curl -X POST https://api.example.com/auth/ably/token \
         -H "Authorization: Bearer your_jwt_token"
    ```
 * @summary Generate Token
 */
export const generateTokenAuthAblyTokenPost = (
  options?: SecondParameter<typeof customInstance>,
  signal?: AbortSignal,
) => {
  return customInstance<AblyTokenResponse>(
    { url: `/auth/ably/token`, method: "POST", signal },
    options,
  );
};

export const getGenerateTokenAuthAblyTokenPostMutationOptions = <
  TError = void,
  TContext = unknown,
>(options?: {
  mutation?: UseMutationOptions<
    Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>,
    TError,
    void,
    TContext
  >;
  request?: SecondParameter<typeof customInstance>;
}): UseMutationOptions<
  Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>,
  TError,
  void,
  TContext
> => {
  const mutationKey = ["generateTokenAuthAblyTokenPost"];
  const { mutation: mutationOptions, request: requestOptions } = options
    ? options.mutation &&
      "mutationKey" in options.mutation &&
      options.mutation.mutationKey
      ? options
      : { ...options, mutation: { ...options.mutation, mutationKey } }
    : { mutation: { mutationKey }, request: undefined };

  const mutationFn: MutationFunction<
    Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>,
    void
  > = () => {
    return generateTokenAuthAblyTokenPost(requestOptions);
  };

  return { mutationFn, ...mutationOptions };
};

export type GenerateTokenAuthAblyTokenPostMutationResult = NonNullable<
  Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>
>;

export type GenerateTokenAuthAblyTokenPostMutationError = void;

/**
 * @summary Generate Token
 */
export const useGenerateTokenAuthAblyTokenPost = <
  TError = void,
  TContext = unknown,
>(
  options?: {
    mutation?: UseMutationOptions<
      Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>,
      TError,
      void,
      TContext
    >;
    request?: SecondParameter<typeof customInstance>;
  },
  queryClient?: QueryClient,
): UseMutationResult<
  Awaited<ReturnType<typeof generateTokenAuthAblyTokenPost>>,
  TError,
  void,
  TContext
> => {
  const mutationOptions =
    getGenerateTokenAuthAblyTokenPostMutationOptions(options);

  return useMutation(mutationOptions, queryClient);
};
